pipeline {
    agent any



    stages {
        stage('Checkout') {
            steps {
                checkout([$class: 'GitSCM',
                          branches: [[name: '*/master']],
                          userRemoteConfigs: [[url: 'https://github.com/Aydarskiy/CucumberAutomationFramework.git',
                                               credentialsId: env.GIT_CREDENTIALS_ID]]])
            }
        }

        stage('Build and Test') {
            steps {
                sh './mvn test'
            }
        }

        stage('Generate Reports') {
            steps {
                cucumber buildStatus: 'UNSTABLE',
                         reportTitle: 'Cucumber Report',
                         fileIncludePattern: 'target/cucumber-reports/*.json',
                         trendsLimit: 10,
                         sortingMethod: 'ALPHABETICAL'
            }
        }
    }

    post {
        always {
            archiveArtifacts artifacts: 'target/cucumber-reports/*.json', allowEmptyArchive: true
            junit 'target/surefire-reports/*.xml'
        }
    }
}
